# ğŸ” PAPÃ‰IS E PERMISSÃ•ES DO SISTEMA

> **Ãšltima atualizaÃ§Ã£o:** 04 de Novembro de 2025  
> **Sistema:** Agzap Delivery - GestÃ£o de Pedidos

---

## ğŸ“Š TABELA DE PERMISSÃ•ES POR PAPEL

| Papel | Pedidos | CardÃ¡pio | RelatÃ³rios | Financeiro | Config |
|-------|---------|----------|------------|------------|--------|
| ğŸ‘‘ **ProprietÃ¡rio** | âœ… Total | âœ… Total | âœ… Total | âœ… Total | âœ… Total |
| âš™ï¸ **Admin** | âœ… Total | âœ… Total | âœ… Total | âœ… Total | âœ… Total |
| ğŸ“Š **Gerente** | âœ… Criar/Editar | âœ… Criar/Editar | âœ… Ver/Exportar | âœ… Ver/Relat | âŒ |
| ğŸ§ **Atendente** | âœ… Criar/Editar | âŒ | âŒ | âœ… Ver | âŒ |
| ğŸ”ª **Cozinha** | ğŸ‘ï¸ Visualizar | âŒ | âŒ | âŒ | âŒ |
| ğŸï¸ **Entregador** | ğŸ‘ï¸ Visualizar | âŒ | âŒ | âŒ | âŒ |

---

## ğŸ¯ DETALHAMENTO DAS PERMISSÃ•ES

### ğŸ‘‘ PROPRIETÃRIO
**Acesso total ao sistema**

#### Pedidos:
- âœ… Criar pedidos
- âœ… Editar pedidos
- âœ… Excluir pedidos
- âœ… Visualizar pedidos
- âœ… Alterar status

#### CardÃ¡pio:
- âœ… Criar produtos
- âœ… Editar produtos
- âœ… Excluir produtos
- âœ… Ativar/Desativar produtos

#### RelatÃ³rios:
- âœ… Visualizar relatÃ³rios
- âœ… Exportar dados

#### Financeiro:
- âœ… Visualizar valores
- âœ… Gerar relatÃ³rios financeiros

#### ConfiguraÃ§Ãµes:
- âœ… Editar empresa
- âœ… Gerenciar usuÃ¡rios

#### PÃ¡ginas AcessÃ­veis:
- âœ… Dashboard
- âœ… Pedidos
- âœ… CardÃ¡pio
- âœ… Clientes
- âœ… Cupons
- âœ… RelatÃ³rios
- âœ… ConfiguraÃ§Ãµes
- âœ… Ajuda

---

### âš™ï¸ ADMIN
**Mesmas permissÃµes do ProprietÃ¡rio**

#### Pedidos:
- âœ… Criar pedidos
- âœ… Editar pedidos
- âœ… Excluir pedidos
- âœ… Visualizar pedidos
- âœ… Alterar status

#### CardÃ¡pio:
- âœ… Criar produtos
- âœ… Editar produtos
- âœ… Excluir produtos
- âœ… Ativar/Desativar produtos

#### RelatÃ³rios:
- âœ… Visualizar relatÃ³rios
- âœ… Exportar dados

#### Financeiro:
- âœ… Visualizar valores
- âœ… Gerar relatÃ³rios financeiros

#### ConfiguraÃ§Ãµes:
- âœ… Editar empresa
- âœ… Gerenciar usuÃ¡rios

#### PÃ¡ginas AcessÃ­veis:
- âœ… Dashboard
- âœ… Pedidos
- âœ… CardÃ¡pio
- âœ… Clientes
- âœ… Cupons
- âœ… RelatÃ³rios
- âœ… ConfiguraÃ§Ãµes
- âœ… Ajuda

---

### ğŸ“Š GERENTE
**GestÃ£o operacional sem excluir dados**

#### Pedidos:
- âœ… Criar pedidos
- âœ… Editar pedidos
- âŒ Excluir pedidos
- âœ… Visualizar pedidos
- âœ… Alterar status

#### CardÃ¡pio:
- âœ… Criar produtos
- âœ… Editar produtos
- âŒ Excluir produtos
- âœ… Ativar/Desativar produtos

#### RelatÃ³rios:
- âœ… Visualizar relatÃ³rios
- âœ… Exportar dados

#### Financeiro:
- âœ… Visualizar valores
- âœ… Gerar relatÃ³rios financeiros

#### ConfiguraÃ§Ãµes:
- âŒ Editar empresa
- âŒ Gerenciar usuÃ¡rios

#### PÃ¡ginas AcessÃ­veis:
- âœ… Dashboard
- âœ… Pedidos
- âœ… CardÃ¡pio
- âœ… Clientes
- âœ… Cupons (apenas visualizaÃ§Ã£o)
- âœ… RelatÃ³rios
- âŒ ConfiguraÃ§Ãµes
- âœ… Ajuda

---

### ğŸ§ ATENDENTE
**Foco em atendimento e pedidos**

#### Pedidos:
- âœ… Criar pedidos
- âœ… Editar pedidos
- âŒ Excluir pedidos
- âœ… Visualizar pedidos
- âœ… Alterar status

#### CardÃ¡pio:
- âŒ Criar produtos
- âŒ Editar produtos
- âŒ Excluir produtos
- âŒ Ativar/Desativar produtos

#### RelatÃ³rios:
- âŒ Visualizar relatÃ³rios
- âŒ Exportar dados

#### Financeiro:
- âœ… Visualizar valores (para calcular pedidos)
- âŒ Gerar relatÃ³rios financeiros

#### ConfiguraÃ§Ãµes:
- âŒ Editar empresa
- âŒ Gerenciar usuÃ¡rios

#### PÃ¡ginas AcessÃ­veis:
- âŒ Dashboard (contÃ©m dados financeiros)
- âœ… Pedidos (com botÃ£o Novo Pedido)
- âŒ CardÃ¡pio
- âœ… Clientes (precisa ver dados para atendimento)
- âŒ Cupons
- âŒ RelatÃ³rios
- âŒ ConfiguraÃ§Ãµes
- âŒ Ajuda

---

### ğŸ”ª COZINHA
**Apenas visualizaÃ§Ã£o e mudanÃ§a de status**

#### Pedidos:
- âŒ Criar pedidos
- âŒ Editar pedidos
- âŒ Excluir pedidos
- âœ… Visualizar pedidos
- âœ… Alterar status (Aceitar â†’ Pronto)

#### CardÃ¡pio:
- âŒ Criar produtos
- âŒ Editar produtos
- âŒ Excluir produtos
- âŒ Ativar/Desativar produtos

#### RelatÃ³rios:
- âŒ Visualizar relatÃ³rios
- âŒ Exportar dados

#### Financeiro:
- âŒ Visualizar valores
- âŒ Gerar relatÃ³rios financeiros

#### ConfiguraÃ§Ãµes:
- âŒ Editar empresa
- âŒ Gerenciar usuÃ¡rios

#### PÃ¡ginas AcessÃ­veis:
- âŒ Dashboard
- âœ… Pedidos (SEM botÃ£o Novo Pedido)
- âŒ CardÃ¡pio
- âŒ Clientes
- âŒ Cupons
- âŒ RelatÃ³rios
- âŒ ConfiguraÃ§Ãµes
- âŒ Ajuda

---

### ğŸï¸ ENTREGADOR
**Apenas visualizaÃ§Ã£o e mudanÃ§a de status**

#### Pedidos:
- âŒ Criar pedidos
- âŒ Editar pedidos
- âŒ Excluir pedidos
- âœ… Visualizar pedidos
- âœ… Alterar status (Saiu p/ Entrega â†’ ConcluÃ­do)

#### CardÃ¡pio:
- âŒ Criar produtos
- âŒ Editar produtos
- âŒ Excluir produtos
- âŒ Ativar/Desativar produtos

#### RelatÃ³rios:
- âŒ Visualizar relatÃ³rios
- âŒ Exportar dados

#### Financeiro:
- âŒ Visualizar valores
- âŒ Gerar relatÃ³rios financeiros

#### ConfiguraÃ§Ãµes:
- âŒ Editar empresa
- âŒ Gerenciar usuÃ¡rios

#### PÃ¡ginas AcessÃ­veis:
- âŒ Dashboard
- âœ… Pedidos (SEM botÃ£o Novo Pedido)
- âŒ CardÃ¡pio
- âŒ Clientes
- âŒ Cupons
- âŒ RelatÃ³rios
- âŒ ConfiguraÃ§Ãµes
- âŒ Ajuda

---

## ğŸ”„ MAPEAMENTO DE ROTAS â†’ PERMISSÃ•ES

| Rota | PermissÃ£o NecessÃ¡ria | Quem Acessa |
|------|---------------------|-------------|
| `/` (Dashboard) | `relatorios.visualizar` | ProprietÃ¡rio, Admin, Gerente |
| `/pedidos` | `pedidos.visualizar` | Todos |
| `/cardapio` | `cardapio.criar_produto` | ProprietÃ¡rio, Admin, Gerente |
| `/clientes` | `financeiro.visualizar_valores` | ProprietÃ¡rio, Admin, Gerente, Atendente |
| `/cupons` | `configuracoes.gerenciar_usuarios` | ProprietÃ¡rio, Admin |
| `/relatorios` | `relatorios.visualizar` | ProprietÃ¡rio, Admin, Gerente |
| `/configuracoes` | `configuracoes.editar_empresa` | ProprietÃ¡rio, Admin |
| `/ajuda` | `financeiro.visualizar_valores` | ProprietÃ¡rio, Admin, Gerente, Atendente |
| `/acesso-negado` | - | Todos (quando negado) |

---

## ğŸ¯ FLUXO DE STATUS DE PEDIDOS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   NOVO   â”‚  â† Cliente faz pedido
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚ Cozinha/Atendente: "Aceitar"
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ COZINHA  â”‚  â† Preparando pedido
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚ Cozinha: "Pronto"
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ENTREGA  â”‚  â† Saiu para entrega (se delivery)
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚ Entregador: "Concluir"
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚CONCLUÃDO â”‚  â† Pedido finalizado
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Atalho para Retirada:**
```
NOVO â†’ COZINHA â†’ CONCLUÃDO
```

---

## ğŸ—‚ï¸ ESTRUTURA DO BANCO DE DADOS

### Tabela: `usuarios_empresas`

```sql
{
  "id": "uuid",
  "usuario_id": "uuid",
  "empresa_id": "uuid",
  "papel": "proprietario|admin|gerente|atendente|cozinha|entregador",
  "permissoes": {
    "pedidos": {
      "criar": boolean,
      "editar": boolean,
      "excluir": boolean,
      "visualizar": boolean,
      "alterar_status": boolean
    },
    "cardapio": {
      "criar_produto": boolean,
      "editar_produto": boolean,
      "excluir_produto": boolean,
      "ativar_desativar": boolean
    },
    "relatorios": {
      "visualizar": boolean,
      "exportar": boolean
    },
    "configuracoes": {
      "editar_empresa": boolean,
      "gerenciar_usuarios": boolean
    },
    "financeiro": {
      "visualizar_valores": boolean,
      "gerar_relatorios": boolean
    }
  },
  "ativo": boolean
}
```

---

## ğŸ”§ COMO ALTERAR PERMISSÃ•ES NO BANCO

### âš ï¸ IMPORTANTE: Sempre alterar `papel` E `permissoes` juntos!

### Exemplo 1: Mudar usuÃ¡rio para Atendente

```sql
UPDATE usuarios_empresas
SET 
  papel = 'atendente',
  permissoes = '{
    "pedidos": {
      "criar": true,
      "editar": true,
      "excluir": false,
      "visualizar": true,
      "alterar_status": true
    },
    "cardapio": {
      "criar_produto": false,
      "editar_produto": false,
      "excluir_produto": false,
      "ativar_desativar": false
    },
    "relatorios": {
      "visualizar": false,
      "exportar": false
    },
    "configuracoes": {
      "editar_empresa": false,
      "gerenciar_usuarios": false
    },
    "financeiro": {
      "visualizar_valores": true,
      "gerar_relatorios": false
    }
  }'::jsonb
WHERE usuario_id = 'UUID_DO_USUARIO'
  AND empresa_id = 'UUID_DA_EMPRESA';
```

### Exemplo 2: Mudar usuÃ¡rio para Cozinha

```sql
UPDATE usuarios_empresas
SET 
  papel = 'cozinha',
  permissoes = '{
    "pedidos": {
      "criar": false,
      "editar": false,
      "excluir": false,
      "visualizar": true,
      "alterar_status": true
    },
    "cardapio": {
      "criar_produto": false,
      "editar_produto": false,
      "excluir_produto": false,
      "ativar_desativar": false
    },
    "relatorios": {
      "visualizar": false,
      "exportar": false
    },
    "configuracoes": {
      "editar_empresa": false,
      "gerenciar_usuarios": false
    },
    "financeiro": {
      "visualizar_valores": false,
      "gerar_relatorios": false
    }
  }'::jsonb
WHERE usuario_id = 'UUID_DO_USUARIO'
  AND empresa_id = 'UUID_DA_EMPRESA';
```

---

## ğŸ“ NOTAS IMPORTANTES

1. **Dashboard restrito:** Atendente e Cozinha NÃƒO podem acessar o dashboard pois contÃ©m informaÃ§Ãµes financeiras sensÃ­veis.

2. **BotÃ£o "Novo Pedido":** SÃ³ aparece para usuÃ¡rios com `pedidos.criar = true` (Atendente e acima).

3. **Menu dinÃ¢mico:** O menu lateral filtra automaticamente as opÃ§Ãµes baseado nas permissÃµes do usuÃ¡rio.

4. **Middleware de proteÃ§Ã£o:** Rotas sÃ£o protegidas por middleware que verifica permissÃµes antes de permitir acesso.

5. **Redirecionamentos:**
   - Login â†’ `/pedidos` (pÃ¡gina padrÃ£o)
   - Sem permissÃ£o para Dashboard â†’ `/pedidos`
   - Sem permissÃ£o para outras rotas â†’ `/acesso-negado`

6. **Logout obrigatÃ³rio:** ApÃ³s alterar permissÃµes no banco, o usuÃ¡rio DEVE fazer logout e login para carregar as novas permissÃµes.

---

## ğŸ“ REGRAS DE NEGÃ“CIO

### âœ… O que SEMPRE verificar:

1. **Campos obrigatÃ³rios no banco:**
   - `papel`: Define o "label" do usuÃ¡rio
   - `permissoes`: JSONB que REALMENTE controla o acesso

2. **AlteraÃ§Ã£o de papel:**
   - NUNCA alterar sÃ³ o campo `papel`
   - SEMPRE atualizar `permissoes` junto

3. **Sistema de verificaÃ§Ã£o:**
   - Menu â†’ usa `temPermissao(modulo, acao)`
   - Middleware â†’ usa `getRoutePermission(path)`
   - Componentes â†’ usam `temPermissao(modulo, acao)` com `v-if`

### âŒ O que NUNCA fazer:

1. âŒ Mudar sÃ³ o `papel` sem atualizar `permissoes`
2. âŒ Confiar apenas no campo `papel` para controle de acesso
3. âŒ Esquecer de pedir logout/login apÃ³s alterar permissÃµes
4. âŒ Dar acesso ao Dashboard para Cozinha/Atendente

---

## ğŸ“ CONTATO E SUPORTE

**Sistema:** Agzap Delivery  
**Desenvolvedor:** Wanderson  
**RepositÃ³rio:** agzapDelivery  
**Branch:** main  
**Ãšltima atualizaÃ§Ã£o:** 04/11/2025

---

**ğŸ” Mantenha este documento atualizado sempre que houver mudanÃ§as nas permissÃµes!**
